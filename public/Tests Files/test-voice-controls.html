<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test de Controles de Voz</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #764ba2;
            margin-bottom: 30px;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f7f9fc;
            border-radius: 8px;
        }
        
        .control-group h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .slider-control {
            margin-bottom: 15px;
        }
        
        .slider-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            outline: none;
        }
        
        .value-display {
            min-width: 60px;
            text-align: right;
            font-weight: 600;
            color: #667eea;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }
        
        button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            display: none;
        }
        
        .result-box.error {
            background: #fef2f2;
            border-color: #fca5a5;
        }
        
        .result-box.show {
            display: block;
        }
        
        audio {
            width: 100%;
            margin-top: 15px;
        }
        
        .api-log {
            margin-top: 20px;
            padding: 15px;
            background: #1e293b;
            color: #10b981;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .test-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .test-status.testing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .test-status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .test-status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .info-box {
            padding: 15px;
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Controles de Voz - Dashboard</h1>
        
        <div class="info-box">
            <strong>‚ÑπÔ∏è Este test verifica que los controles de voz est√°n funcionando correctamente:</strong>
            <ul style="margin-top: 10px;">
                <li>Los sliders deben actualizar los valores en tiempo real</li>
                <li>Los valores deben enviarse correctamente a la API</li>
                <li>El audio generado debe reflejar los cambios en los par√°metros</li>
            </ul>
        </div>
        
        <div class="control-group">
            <h3>üìù Texto de Prueba</h3>
            <textarea id="testText" placeholder="Escribe el texto a convertir...">Esta es una prueba de los controles de voz. Los par√°metros de estilo, estabilidad y similitud afectan c√≥mo suena el audio generado.</textarea>
        </div>
        
        <div class="control-group">
            <h3>üéõÔ∏è Controles de Voz</h3>
            
            <div class="slider-control">
                <label>Estilo (Style):</label>
                <div class="slider-wrapper">
                    <input type="range" id="styleSlider" min="0" max="100" value="50">
                    <span class="value-display" id="styleValue">50%</span>
                </div>
                <small>Controla qu√© tan expresivo es el audio (0=neutro, 100=muy expresivo)</small>
            </div>
            
            <div class="slider-control">
                <label>Estabilidad (Stability):</label>
                <div class="slider-wrapper">
                    <input type="range" id="stabilitySlider" min="0" max="100" value="75">
                    <span class="value-display" id="stabilityValue">75%</span>
                </div>
                <small>Controla la consistencia de la voz (0=variable, 100=muy estable)</small>
            </div>
            
            <div class="slider-control">
                <label>Similitud (Similarity Boost):</label>
                <div class="slider-wrapper">
                    <input type="range" id="claritySlider" min="0" max="100" value="80">
                    <span class="value-display" id="clarityValue">80%</span>
                </div>
                <small>Qu√© tan similar a la voz original debe sonar (0=baja, 100=alta)</small>
            </div>
            
            <div style="margin-top: 15px;">
                <label>
                    <input type="checkbox" id="speakerBoost" checked>
                    <strong>Speaker Boost</strong> - Mejora la claridad y reduce artefactos
                </label>
            </div>
        </div>
        
        <button id="testBtn" onclick="runTest()">üé§ Generar Audio con estos Par√°metros</button>
        
        <div id="testStatus" class="test-status" style="display: none;"></div>
        
        <div id="resultBox" class="result-box"></div>
        
        <div class="api-log" id="apiLog" style="display: none;">
            <strong>üì° API Log:</strong>
            <pre id="logContent"></pre>
        </div>
    </div>
    
    <script>
        // Configurar sliders
        document.getElementById('styleSlider').addEventListener('input', (e) => {
            document.getElementById('styleValue').textContent = e.target.value + '%';
        });
        
        document.getElementById('stabilitySlider').addEventListener('input', (e) => {
            document.getElementById('stabilityValue').textContent = e.target.value + '%';
        });
        
        document.getElementById('claritySlider').addEventListener('input', (e) => {
            document.getElementById('clarityValue').textContent = e.target.value + '%';
        });
        
        function showStatus(message, type) {
            const status = document.getElementById('testStatus');
            status.textContent = message;
            status.className = 'test-status ' + type;
            status.style.display = 'flex';
        }
        
        function showResult(content, isError = false) {
            const box = document.getElementById('resultBox');
            box.innerHTML = content;
            box.className = isError ? 'result-box error show' : 'result-box show';
        }
        
        function addLog(message) {
            const log = document.getElementById('apiLog');
            const content = document.getElementById('logContent');
            log.style.display = 'block';
            content.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            log.scrollTop = log.scrollHeight;
        }
        
        async function runTest() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            
            // Limpiar resultados anteriores
            document.getElementById('resultBox').className = 'result-box';
            document.getElementById('logContent').textContent = '';
            
            showStatus('üîÑ Generando audio con los par√°metros actuales...', 'testing');
            
            // Obtener valores
            const text = document.getElementById('testText').value;
            const styleValue = document.getElementById('styleSlider').value / 100;
            const stabilityValue = document.getElementById('stabilitySlider').value / 100;
            const clarityValue = document.getElementById('claritySlider').value / 100;
            const speakerBoost = document.getElementById('speakerBoost').checked;
            
            addLog('Iniciando test de generaci√≥n');
            addLog('Par√°metros:');
            addLog('  - Style: ' + styleValue);
            addLog('  - Stability: ' + stabilityValue);
            addLog('  - Similarity Boost: ' + clarityValue);
            addLog('  - Speaker Boost: ' + speakerBoost);
            
            try {
                const requestData = {
                    action: 'generate_audio',
                    text: text,
                    voice: 'G4IAP30yc6c1gK0csDfu', // Juan Carlos
                    category: 'sin_categoria',
                    voice_settings: {
                        style: styleValue,
                        stability: stabilityValue,
                        similarity_boost: clarityValue,
                        use_speaker_boost: speakerBoost
                    }
                };
                
                addLog('Enviando request a /api/generate.php');
                addLog('Payload: ' + JSON.stringify(requestData.voice_settings));
                
                const response = await fetch('/api/generate.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                addLog('Respuesta recibida: ' + JSON.stringify(data));
                
                if (data.success && data.filename) {
                    showStatus('‚úÖ Audio generado exitosamente', 'success');
                    
                    const audioUrl = `/api/temp/${data.filename}`;
                    
                    showResult(`
                        <h3>‚úÖ Test Exitoso</h3>
                        <p><strong>Los controles est√°n funcionando correctamente!</strong></p>
                        <div style="margin-top: 15px; padding: 15px; background: #f7f9fc; border-radius: 8px;">
                            <strong>Par√°metros aplicados:</strong>
                            <ul>
                                <li>Style: ${(styleValue * 100).toFixed(0)}%</li>
                                <li>Stability: ${(stabilityValue * 100).toFixed(0)}%</li>
                                <li>Similarity Boost: ${(clarityValue * 100).toFixed(0)}%</li>
                                <li>Speaker Boost: ${speakerBoost ? 'Activado' : 'Desactivado'}</li>
                            </ul>
                        </div>
                        <audio controls src="${audioUrl}"></audio>
                        <p style="margin-top: 10px; font-size: 12px; color: #666;">
                            Prueba cambiar los valores de los sliders y genera de nuevo para escuchar la diferencia.
                        </p>
                    `);
                    
                    addLog('‚úÖ Test completado exitosamente');
                    
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
                
            } catch (error) {
                showStatus('‚ùå Error en el test', 'error');
                showResult(`
                    <h3>‚ùå Error en el Test</h3>
                    <p>${error.message}</p>
                    <p>Revisa el log para m√°s detalles.</p>
                `, true);
                
                addLog('‚ùå Error: ' + error.message);
            } finally {
                btn.disabled = false;
            }
        }
        
        // Test inicial autom√°tico con valores por defecto
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Test de Controles de Voz listo');
            console.log('Los controles est√°n configurados correctamente en el dashboard.');
            console.log('Haz clic en el bot√≥n para probar la generaci√≥n con diferentes par√°metros.');
        });
    </script>
</body>
</html>