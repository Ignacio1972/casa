<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MessageActions - Versi√≥n Simplificada</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-section h2 {
            color: #00BCD4;
            margin-top: 0;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #81C784;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #F44336;
            color: #EF5350;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
            color: #64B5F6;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            color: #FFD54F;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .test-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .code-block {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test MessageActions - Versi√≥n Simplificada</h1>
    
    <div class="test-section" style="background: rgba(255,193,7,0.1); border-color: #FFC107;">
        <h2 style="color: #FFC107;">üìå Instrucciones de Uso</h2>
        <div class="test-result warning">
            ‚ö†Ô∏è Esta es una versi√≥n simplificada que NO carga los m√≥dulos reales
        </div>
        <div class="test-result info">
            üìã Esta p√°gina verifica si window.campaignLibrary est√° disponible en tu aplicaci√≥n
        </div>
        <div class="test-result info">
            üîç Abre primero tu aplicaci√≥n principal en otra pesta√±a para cargar los m√≥dulos
        </div>
        <div class="test-result info">
            ‚úÖ Luego usa esta p√°gina para verificar que todo funciona correctamente
        </div>
        <button onclick="location.reload()" style="background: #FF9800;">üîÑ Recargar P√°gina</button>
        <button onclick="clearAllResults()" style="background: #9C27B0;">üßπ Limpiar Resultados</button>
    </div>
    
    <div class="test-section">
        <h2>1. Estado Global de window.campaignLibrary</h2>
        <div id="global-status"></div>
        <div class="test-controls">
            <button onclick="checkGlobalStatus()">üîç Verificar Estado Global</button>
            <button onclick="listAvailableMethods()">üìã Listar M√©todos Disponibles</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>2. Verificaci√≥n de M√≥dulos</h2>
        <div id="module-check"></div>
        <div class="test-controls">
            <button onclick="checkCampaignModule()">üéØ Verificar campaignModule</button>
            <button onclick="checkMessageActions()">üì¶ Verificar MessageActions</button>
            <button onclick="checkMessages()">üì® Verificar Mensajes Cargados</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3. Pruebas de Funcionalidad</h2>
        <div id="function-tests"></div>
        <div class="test-controls">
            <button onclick="testPlayFunction()">‚ñ∂Ô∏è Probar playMessage</button>
            <button onclick="testEditFunction()">‚úèÔ∏è Probar editMessage</button>
            <button onclick="testScheduleFunction()">üìÖ Probar scheduleMessage</button>
            <button onclick="testDeleteFunction()">üóëÔ∏è Probar deleteMessage</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>4. An√°lisis de Delegaci√≥n</h2>
        <div id="delegation-analysis"></div>
        <div class="test-controls">
            <button onclick="analyzeDelegation()">üîó Analizar Delegaci√≥n</button>
            <button onclick="verifyReferences()">üîç Verificar Referencias</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>5. Consola de Pruebas</h2>
        <div id="console-output"></div>
        <div class="test-controls">
            <input type="text" id="console-input" placeholder="Escribe c√≥digo JavaScript aqu√≠..." style="flex: 1; padding: 10px; background: #333; color: white; border: 1px solid #555;">
            <button onclick="executeCode()">‚ñ∂Ô∏è Ejecutar</button>
        </div>
    </div>

    <script>
        // Funci√≥n auxiliar para agregar resultados
        function addResult(section, message, type = 'info') {
            const element = document.getElementById(section);
            if (!element) {
                console.error(`Elemento ${section} no encontrado`);
                return;
            }
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            element.appendChild(result);
        }
        
        // Limpiar todos los resultados
        function clearAllResults() {
            document.querySelectorAll('.test-result').forEach(el => {
                if (!el.textContent.includes('Instrucciones')) {
                    el.remove();
                }
            });
        }
        
        // 1. Verificar estado global
        function checkGlobalStatus() {
            console.log('Verificando estado global...');
            
            if (typeof window.campaignLibrary !== 'undefined') {
                addResult('global-status', '‚úÖ window.campaignLibrary est√° definido', 'success');
                addResult('global-status', `Tipo: ${typeof window.campaignLibrary}`, 'info');
                
                if (window.campaignLibrary && typeof window.campaignLibrary === 'object') {
                    const keys = Object.keys(window.campaignLibrary);
                    addResult('global-status', `N√∫mero de propiedades: ${keys.length}`, 'info');
                }
            } else {
                addResult('global-status', '‚ùå window.campaignLibrary NO est√° definido', 'error');
                addResult('global-status', 'Sugerencia: Abre tu aplicaci√≥n principal primero', 'warning');
            }
            
            // Verificar window.campaignModule tambi√©n
            if (typeof window.campaignModule !== 'undefined') {
                addResult('global-status', '‚úÖ window.campaignModule tambi√©n est√° disponible', 'success');
            } else {
                addResult('global-status', '‚ö†Ô∏è window.campaignModule no est√° disponible', 'warning');
            }
        }
        
        // 2. Listar m√©todos disponibles
        function listAvailableMethods() {
            if (!window.campaignLibrary) {
                addResult('global-status', '‚ùå campaignLibrary no est√° disponible', 'error');
                return;
            }
            
            const expectedMethods = [
                'playMessage', 'editMessage', 'sendToRadio', 'scheduleMessage',
                'deleteMessage', 'toggleCategoryDropdown', 'updateCategory', 'changeCategory',
                'applyFilter', 'clearFilters'
            ];
            
            addResult('global-status', '<strong>M√©todos en window.campaignLibrary:</strong>', 'info');
            
            for (const method of expectedMethods) {
                if (typeof window.campaignLibrary[method] === 'function') {
                    addResult('global-status', `‚úÖ ${method}() - Disponible`, 'success');
                } else if (window.campaignLibrary[method]) {
                    addResult('global-status', `‚ö†Ô∏è ${method} - Existe pero no es funci√≥n`, 'warning');
                } else {
                    addResult('global-status', `‚ùå ${method}() - NO disponible`, 'error');
                }
            }
            
            // Buscar m√©todos adicionales no esperados
            const actualMethods = Object.keys(window.campaignLibrary || {});
            const unexpected = actualMethods.filter(m => !expectedMethods.includes(m));
            if (unexpected.length > 0) {
                addResult('global-status', `‚ÑπÔ∏è M√©todos adicionales encontrados: ${unexpected.join(', ')}`, 'info');
            }
        }
        
        // 3. Verificar m√≥dulo Campaign
        function checkCampaignModule() {
            if (window.campaignModule) {
                addResult('module-check', '‚úÖ window.campaignModule existe', 'success');
                
                // Verificar propiedades importantes
                const props = ['messages', 'messageActions', 'container', 'initialized'];
                props.forEach(prop => {
                    if (window.campaignModule[prop] !== undefined) {
                        addResult('module-check', `‚úÖ campaignModule.${prop} existe`, 'success');
                    } else {
                        addResult('module-check', `‚ùå campaignModule.${prop} no existe`, 'error');
                    }
                });
            } else {
                addResult('module-check', '‚ùå window.campaignModule no existe', 'error');
                addResult('module-check', 'El m√≥dulo principal no est√° cargado', 'warning');
            }
        }
        
        // 4. Verificar MessageActions
        function checkMessageActions() {
            if (!window.campaignModule) {
                addResult('module-check', '‚ùå Necesitas campaignModule primero', 'error');
                return;
            }
            
            if (window.campaignModule.messageActions) {
                addResult('module-check', '‚úÖ messageActions est√° inicializado', 'success');
                
                // Verificar referencia parent
                if (window.campaignModule.messageActions.parent === window.campaignModule) {
                    addResult('module-check', '‚úÖ Referencia parent correcta', 'success');
                } else {
                    addResult('module-check', '‚ùå Referencia parent incorrecta', 'error');
                }
                
                // Verificar m√©todos de MessageActions
                const methods = ['getMessage', 'playMessage', 'editMessage', 'sendToRadio',
                               'scheduleMessage', 'deleteMessage', 'toggleCategoryDropdown',
                               'updateCategory', 'changeCategory'];
                
                methods.forEach(method => {
                    if (typeof window.campaignModule.messageActions[method] === 'function') {
                        addResult('module-check', `‚úÖ messageActions.${method} disponible`, 'success');
                    } else {
                        addResult('module-check', `‚ùå messageActions.${method} NO disponible`, 'error');
                    }
                });
            } else {
                addResult('module-check', '‚ùå messageActions NO est√° inicializado', 'error');
            }
        }
        
        // 5. Verificar mensajes cargados
        function checkMessages() {
            if (!window.campaignModule) {
                addResult('module-check', '‚ùå campaignModule no disponible', 'error');
                return;
            }
            
            if (window.campaignModule.messages) {
                const count = window.campaignModule.messages.length;
                addResult('module-check', `üìä Mensajes cargados: ${count}`, 'info');
                
                if (count > 0) {
                    // Mostrar primer mensaje como ejemplo
                    const first = window.campaignModule.messages[0];
                    addResult('module-check', 
                        `Ejemplo: ID=${first.id}, T√≠tulo="${first.title}", Tipo=${first.type}`, 
                        'info');
                }
            } else {
                addResult('module-check', '‚ö†Ô∏è No hay mensajes cargados', 'warning');
            }
        }
        
        // 6. Pruebas de funciones
        function testPlayFunction() {
            if (!window.campaignLibrary || !window.campaignLibrary.playMessage) {
                addResult('function-tests', '‚ùå playMessage no disponible', 'error');
                return;
            }
            
            try {
                // Intentar con un ID de prueba
                addResult('function-tests', 'üéµ Intentando playMessage("test")...', 'info');
                window.campaignLibrary.playMessage('test');
                addResult('function-tests', '‚úÖ playMessage ejecutado (verificar consola)', 'success');
            } catch (error) {
                addResult('function-tests', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function testEditFunction() {
            if (!window.campaignLibrary || !window.campaignLibrary.editMessage) {
                addResult('function-tests', '‚ùå editMessage no disponible', 'error');
                return;
            }
            
            try {
                // Mock prompt para evitar interacci√≥n
                const originalPrompt = window.prompt;
                window.prompt = () => null;
                
                addResult('function-tests', '‚úèÔ∏è Probando editMessage("test")...', 'info');
                window.campaignLibrary.editMessage('test');
                
                window.prompt = originalPrompt;
                addResult('function-tests', '‚úÖ editMessage ejecutado', 'success');
            } catch (error) {
                addResult('function-tests', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function testScheduleFunction() {
            if (!window.campaignLibrary || !window.campaignLibrary.scheduleMessage) {
                addResult('function-tests', '‚ùå scheduleMessage no disponible', 'error');
                return;
            }
            
            try {
                addResult('function-tests', 'üìÖ Probando scheduleMessage("test", "Test Title")...', 'info');
                window.campaignLibrary.scheduleMessage('test', 'Test Title');
                addResult('function-tests', '‚úÖ scheduleMessage ejecutado', 'success');
            } catch (error) {
                addResult('function-tests', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function testDeleteFunction() {
            if (!window.campaignLibrary || !window.campaignLibrary.deleteMessage) {
                addResult('function-tests', '‚ùå deleteMessage no disponible', 'error');
                return;
            }
            
            try {
                // Mock confirm
                const originalConfirm = window.confirm;
                window.confirm = () => false;
                
                addResult('function-tests', 'üóëÔ∏è Probando deleteMessage("test")...', 'info');
                window.campaignLibrary.deleteMessage('test');
                
                window.confirm = originalConfirm;
                addResult('function-tests', '‚úÖ deleteMessage ejecutado', 'success');
            } catch (error) {
                addResult('function-tests', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // 7. Analizar delegaci√≥n
        function analyzeDelegation() {
            if (!window.campaignLibrary) {
                addResult('delegation-analysis', '‚ùå campaignLibrary no disponible', 'error');
                return;
            }
            
            const methods = ['playMessage', 'editMessage', 'scheduleMessage', 'deleteMessage'];
            
            methods.forEach(method => {
                if (window.campaignLibrary[method]) {
                    const funcString = window.campaignLibrary[method].toString();
                    
                    // Verificar si es una arrow function
                    if (funcString.includes('=>')) {
                        addResult('delegation-analysis', 
                            `‚úÖ ${method} es arrow function (delegaci√≥n correcta)`, 'success');
                    }
                    
                    // Verificar si menciona messageActions
                    if (funcString.includes('messageActions')) {
                        addResult('delegation-analysis', 
                            `‚úÖ ${method} referencia a messageActions`, 'success');
                    } else {
                        addResult('delegation-analysis', 
                            `‚ö†Ô∏è ${method} no parece referenciar messageActions`, 'warning');
                    }
                    
                    // Mostrar preview del c√≥digo
                    const preview = funcString.substring(0, 100);
                    addResult('delegation-analysis', 
                        `<div class="code-block">${method}: ${preview}...</div>`, 'info');
                }
            });
        }
        
        // 8. Verificar referencias
        function verifyReferences() {
            if (!window.campaignModule || !window.campaignModule.messageActions) {
                addResult('delegation-analysis', '‚ùå M√≥dulos no disponibles', 'error');
                return;
            }
            
            // Verificar que messageActions puede acceder a parent
            const ma = window.campaignModule.messageActions;
            
            if (ma.parent === window.campaignModule) {
                addResult('delegation-analysis', '‚úÖ messageActions.parent apunta a campaignModule', 'success');
            } else {
                addResult('delegation-analysis', '‚ùå Referencia parent incorrecta', 'error');
            }
            
            // Verificar acceso a datos cr√≠ticos
            if (ma.parent && ma.parent.messages) {
                addResult('delegation-analysis', '‚úÖ messageActions puede acceder a messages', 'success');
            }
            
            if (ma.parent && typeof ma.parent.showError === 'function') {
                addResult('delegation-analysis', '‚úÖ messageActions puede acceder a showError', 'success');
            }
            
            if (ma.parent && typeof ma.parent.showSuccess === 'function') {
                addResult('delegation-analysis', '‚úÖ messageActions puede acceder a showSuccess', 'success');
            }
            
            if (ma.parent && typeof ma.parent.displayMessages === 'function') {
                addResult('delegation-analysis', '‚úÖ messageActions puede acceder a displayMessages', 'success');
            }
        }
        
        // 9. Ejecutar c√≥digo personalizado
        function executeCode() {
            const input = document.getElementById('console-input');
            const code = input.value.trim();
            
            if (!code) {
                addResult('console-output', '‚ö†Ô∏è Escribe algo de c√≥digo primero', 'warning');
                return;
            }
            
            addResult('console-output', `> ${code}`, 'info');
            
            try {
                const result = eval(code);
                addResult('console-output', 
                    `< ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                addResult('console-output', `‚ùå Error: ${error.message}`, 'error');
            }
            
            input.value = '';
        }
        
        // Permitir ejecutar con Enter
        document.getElementById('console-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeCode();
            }
        });
        
        // Mensaje inicial
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ P√°gina de pruebas simplificada cargada');
            console.log('üìã Usa los botones para verificar el estado de MessageActions');
            
            // Auto-verificar si campaignLibrary existe
            setTimeout(() => {
                if (window.campaignLibrary) {
                    addResult('global-status', 'üéâ window.campaignLibrary detectado autom√°ticamente!', 'success');
                    checkGlobalStatus();
                } else {
                    addResult('global-status', '‚ÑπÔ∏è window.campaignLibrary no detectado. Abre tu aplicaci√≥n primero.', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>