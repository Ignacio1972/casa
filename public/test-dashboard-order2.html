<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard Order - Casa Costanera</title>
    <link rel="stylesheet" href="/styles-v5/main.css">
    <style>
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #333;
            padding: 20px;
            z-index: 10000;
            width: 350px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            border-radius: 8px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .test-controls h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .test-btn {
            display: block;
            width: 100%;
            margin: 8px 0;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-btn:hover {
            background: #45a049;
        }
        
        .test-btn.warning {
            background: #ff9800;
        }
        
        .test-btn.danger {
            background: #f44336;
        }
        
        .dom-inspector {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        
        .dom-item {
            margin: 4px 0;
            padding: 6px;
            background: white;
            border-radius: 3px;
            border-left: 4px solid #ddd;
        }
        
        .dom-item.ai {
            border-color: #ff4444;
            background: #fff5f5;
            font-weight: bold;
        }
        
        .dom-item.generator {
            border-color: #4CAF50;
            background: #f1f8e9;
        }
        
        .dom-item.controls {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        
        .dom-item.messages {
            border-color: #9c27b0;
            background: #f3e5f5;
        }
        
        .status-box {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .status-success {
            background: #c8e6c9;
            color: #1b5e20;
            border: 1px solid #4CAF50;
        }
        
        .status-error {
            background: #ffcdd2;
            color: #b71c1c;
            border: 1px solid #f44336;
        }
        
        .status-info {
            background: #bbdefb;
            color: #0d47a1;
            border: 1px solid #2196F3;
        }
        
        /* Resaltado para testing */
        .highlight-test {
            outline: 4px solid red !important;
            outline-offset: 2px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { outline-color: red; }
            50% { outline-color: orange; }
            100% { outline-color: red; }
        }
    </style>
</head>
<body>
    <!-- Panel de Control -->
    <div class="test-controls">
        <h3>üîß Test Dashboard Order</h3>
        
        <div class="status-box status-info">
            <strong>Objetivo:</strong> Hacer que el componente AI aparezca ANTES del generador de mensajes
        </div>
        
        <!-- Inspector DOM -->
        <div id="domInspector" class="dom-inspector">
            <center>Cargando...</center>
        </div>
        
        <!-- Botones de acci√≥n -->
        <button class="test-btn" onclick="inspectDOM()">
            üîç Inspeccionar DOM Actual
        </button>
        
        <button class="test-btn" onclick="findAIComponent()">
            üéØ Buscar Componente AI
        </button>
        
        <hr style="margin: 15px 0;">
        
        <h4>Soluciones a Probar:</h4>
        
        <button class="test-btn" onclick="solution1()">
            1Ô∏è‚É£ Mover AI con JavaScript
        </button>
        
        <button class="test-btn" onclick="solution2()">
            2Ô∏è‚É£ CSS Grid Row Fix
        </button>
        
        <button class="test-btn" onclick="solution3()">
            3Ô∏è‚É£ Flexbox + Order
        </button>
        
        <button class="test-btn" onclick="solution4()">
            4Ô∏è‚É£ PrependChild Solution
        </button>
        
        <button class="test-btn warning" onclick="solution5()">
            5Ô∏è‚É£ Force First Position
        </button>
        
        <button class="test-btn danger" onclick="location.reload()">
            üîÑ Reset Todo
        </button>
        
        <!-- Resultado -->
        <div id="statusResult" class="status-box" style="display: none;"></div>
    </div>
    
    <!-- Dashboard Container -->
    <div id="app" class="container"></div>
    
    <script type="module">
        // Importar m√≥dulos necesarios
        import { eventBus } from '/src/core/event-bus.js';
        import { apiClient } from '/src/core/api-client.js';
        import { moduleLoader } from '/src/core/module-loader.js';
        
        // Hacerlos globales para testing
        window.eventBus = eventBus;
        window.apiClient = apiClient;
        window.moduleLoader = moduleLoader;
        
        // Cargar dashboard autom√°ticamente
        window.addEventListener('load', async () => {
            try {
                await moduleLoader.loadModule('dashboard');
                setTimeout(() => {
                    window.inspectDOM();
                }, 1500);
            } catch (error) {
                console.error('Error cargando dashboard:', error);
                showStatus('Error cargando dashboard: ' + error.message, 'error');
            }
        });
    </script>
    
    <script>
        // Funci√≥n para inspeccionar el DOM
        function inspectDOM() {
            const grid = document.querySelector('.dashboard-grid');
            const inspector = document.getElementById('domInspector');
            
            if (!grid) {
                inspector.innerHTML = '<div style="color: red; text-align: center;">‚ùå No se encontr√≥ .dashboard-grid</div>';
                
                // Buscar alternativas
                const app = document.getElementById('app');
                if (app && app.children.length > 0) {
                    inspector.innerHTML += '<br><strong>Contenido de #app:</strong><br>';
                    Array.from(app.children).forEach((child, i) => {
                        inspector.innerHTML += `${i+1}. ${child.tagName} - ${child.className}<br>`;
                    });
                }
                return;
            }
            
            let html = '<strong>üìã Orden actual en dashboard-grid:</strong><br>';
            const children = Array.from(grid.children);
            
            children.forEach((child, index) => {
                const classes = child.className;
                let title = 'Desconocido';
                let type = '';
                
                // Buscar t√≠tulo
                const titleEl = child.querySelector('.card-title, h2, h3');
                if (titleEl) {
                    title = titleEl.textContent.trim();
                }
                
                // Determinar tipo
                if (classes.includes('ai-') || title.includes('IA') || title.includes('Asistente')) {
                    type = 'ai';
                } else if (classes.includes('create-message') || title.includes('Generador')) {
                    type = 'generator';
                } else if (classes.includes('controls') || title.includes('Controles')) {
                    type = 'controls';
                } else if (classes.includes('recent') || title.includes('Recientes')) {
                    type = 'messages';
                }
                
                html += `<div class="dom-item ${type}">
                    ${index + 1}. ${title}
                    <br><small>class: ${classes || 'sin clases'}</small>
                </div>`;
            });
            
            inspector.innerHTML = html;
        }
        
        // Buscar componente AI
        function findAIComponent() {
            // Limpiar highlights anteriores
            document.querySelectorAll('.highlight-test').forEach(el => {
                el.classList.remove('highlight-test');
            });
            
            const selectors = [
                '.ai-suggestions-container',
                '.ai-assistant-card',
                '.ai-panel',
                '[class*="ai-"]',
                '#aiSuggestionsContainer',
                '#aiPanel'
            ];
            
            let found = false;
            let results = [];
            
            selectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    found = true;
                    element.classList.add('highlight-test');
                    results.push(`‚úÖ ${selector}`);
                    
                    // Info adicional
                    const parent = element.parentElement;
                    if (parent) {
                        results.push(`   Parent: ${parent.className || parent.tagName}`);
                    }
                }
            });
            
            if (found) {
                showStatus('Componente AI encontrado:<br>' + results.join('<br>'), 'success');
            } else {
                showStatus('‚ùå No se encontr√≥ ning√∫n componente AI', 'error');
            }
        }
        
        // Soluci√≥n 1: Mover con JavaScript
        function solution1() {
            const grid = document.querySelector('.dashboard-grid');
            const ai = document.querySelector('.ai-suggestions-container, [class*="ai-"]');
            
            if (grid && ai) {
                grid.insertBefore(ai, grid.firstChild);
                showStatus('‚úÖ Soluci√≥n 1 aplicada: AI movido al principio con JavaScript', 'success');
                setTimeout(inspectDOM, 100);
            } else {
                showStatus('‚ùå No se pudo aplicar: grid=' + !!grid + ', ai=' + !!ai, 'error');
            }
        }
        
        // Soluci√≥n 2: CSS Grid Row
        function solution2() {
            const style = document.createElement('style');
            style.innerHTML = `
                .ai-suggestions-container,
                [class*="ai-suggestions"] {
                    grid-row: 1 !important;
                    grid-column: 1 !important;
                }
                .create-message {
                    grid-row: 2 !important;
                }
                .controls-section {
                    grid-row: 3 !important;
                }
            `;
            document.head.appendChild(style);
            
            showStatus('‚úÖ Soluci√≥n 2 aplicada: CSS Grid rows forzados', 'success');
            setTimeout(inspectDOM, 100);
        }
        
        // Soluci√≥n 3: Flexbox + Order
        function solution3() {
            const style = document.createElement('style');
            style.innerHTML = `
                .dashboard-grid {
                    display: flex !important;
                    flex-wrap: wrap !important;
                }
                .ai-suggestions-container,
                [class*="ai-suggestions"] {
                    order: -1 !important;
                    width: 60% !important;
                }
                .create-message {
                    order: 0 !important;
                    width: 60% !important;
                }
                .controls-section {
                    order: 1 !important;
                    width: 60% !important;
                }
                .recent-messages {
                    order: 2 !important;
                    width: 40% !important;
                }
            `;
            document.head.appendChild(style);
            
            showStatus('‚úÖ Soluci√≥n 3 aplicada: Flexbox con order=-1 para AI', 'success');
            setTimeout(inspectDOM, 100);
        }
        
        // Soluci√≥n 4: PrependChild
        function solution4() {
            const grid = document.querySelector('.dashboard-grid');
            const ai = document.querySelector('.ai-suggestions-container, [class*="ai-"]');
            
            if (grid && ai) {
                // Remover y volver a agregar al principio
                if (ai.parentNode) {
                    ai.parentNode.removeChild(ai);
                }
                grid.prepend(ai);
                
                showStatus('‚úÖ Soluci√≥n 4 aplicada: Prepend directo del componente AI', 'success');
                setTimeout(inspectDOM, 100);
            } else {
                showStatus('‚ùå No se pudo aplicar soluci√≥n 4', 'error');
            }
        }
        
        // Soluci√≥n 5: Forzar primera posici√≥n
        function solution5() {
            const grid = document.querySelector('.dashboard-grid');
            if (!grid) {
                showStatus('‚ùå No se encontr√≥ dashboard-grid', 'error');
                return;
            }
            
            // Buscar AI con m√∫ltiples selectores
            let ai = null;
            const selectors = [
                '.ai-suggestions-container',
                '.ai-assistant-card',
                '[class*="ai-"]',
                '#aiSuggestionsContainer'
            ];
            
            for (let selector of selectors) {
                ai = document.querySelector(selector);
                if (ai) break;
            }
            
            if (ai) {
                // Clonar para evitar problemas de referencia
                const aiClone = ai.cloneNode(true);
                ai.remove();
                
                // Insertar al principio
                grid.insertBefore(aiClone, grid.firstChild);
                
                showStatus('‚úÖ Soluci√≥n 5: AI clonado y forzado a primera posici√≥n', 'success');
                setTimeout(inspectDOM, 100);
            } else {
                showStatus('‚ùå No se encontr√≥ componente AI con ning√∫n selector', 'error');
            }
        }
        
        // Mostrar estado
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusResult');
            statusDiv.className = 'status-box status-' + type;
            statusDiv.innerHTML = message;
            statusDiv.style.display = 'block';
        }
        
        // Auto-actualizar DOM cada 3 segundos
        setInterval(() => {
            if (document.querySelector('.dashboard-grid')) {
                inspectDOM();
            }
        }, 3000);
    </script>
</body>
</html>